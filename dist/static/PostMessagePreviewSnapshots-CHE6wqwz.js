import{ca as w,cb as P,a as s,bF as S,bA as _,d0 as E,cy as x,d1 as M,d2 as k,cN as R,cD as $,d3 as y,b1 as v,c$ as D,d4 as F,cY as U,g as j}from"./sanity.config-CV2lftew.js";function I(u){return w(function(t,a){var i=!1,n=0;t.subscribe(P(a,function(r){return(i||(i=!u(r,n++)))&&a.next(r)}))})}const N=u=>{const{comlink:t,refs:a,perspective:i}=u,n=S(),r=_(),c=s.useMemo(()=>new E,[]),b=s.useMemo(()=>c.asObservable().pipe(x(d=>k(d.map(e=>{const f={...e,_id:R(e._id)},m=i==="published"?$:n.observeForPreview(f,r.get(f._type)).pipe(y(),I(o=>o.snapshot===null)),h={...e,_id:v(e._id)},g=n.observeForPreview(h,r.get(h._type));return D(g.pipe(F(m)),m).pipe(U(o=>!!o.snapshot),j(o=>{const p=o.snapshot;return{_id:v(p._id),title:p.title,subtitle:p.subtitle,description:p.description,imageUrl:p.imageUrl}}))}))),M(0)),[n,c,r,i]),l=s.useRef([]);return s.useEffect(()=>{const d=b.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),l.current=e});return()=>{d.unsubscribe()}},[t,b]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:l.current})),[t]),s.useEffect(()=>{c.next(a)},[a,c]),null};var A=s.memo(N);export{A as default};
